<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ©</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-bg: #121828;
            --secondary-bg: #1a2238;
            --accent-color: #00f7ff;
            --text-color: #f0f8ff;
            --danger-color: #ff3d71;
            --success-color: #00ffab;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
            padding: 15px;
        }

        #game-container {
            width: 100%;
            max-width: 450px;
            background-color: var(--secondary-bg);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(0, 247, 255, 0.2);
            border: 1px solid var(--accent-color);
        }

        .screen { display: none; }
        .screen.active { display: block; }

        h1, h2, h3 {
            color: var(--accent-color);
            margin-bottom: 1rem;
            text-shadow: 0 0 10px var(--accent-color);
        }

        h1 { font-size: 2.5rem; }
        h2 { font-size: 2rem; }
        h3 { font-size: 1.5rem; }

        p { font-size: 1.1rem; line-height: 1.6; margin-bottom: 1.5rem; }

        .button {
            display: inline-block;
            background-color: var(--accent-color);
            color: var(--primary-bg);
            padding: 12px 25px;
            border-radius: 10px;
            border: none;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            width: 100%;
            max-width: 300px;
        }

        .button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px var(--accent-color);
        }

        .button.secondary {
            background: transparent;
            border: 2px solid var(--accent-color);
            color: var(--accent-color);
        }

        .button:disabled {
            background-color: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .input-group { display: flex; margin-bottom: 1.5rem; gap: 10px; }

        input[type="text"] {
            flex-grow: 1;
            padding: 12px;
            border-radius: 10px;
            border: 2px solid var(--accent-color);
            background-color: var(--primary-bg);
            color: var(--text-color);
            font-size: 1rem;
        }

        .player-list { list-style: none; padding: 0; margin-bottom: 1.5rem; }

        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--primary-bg);
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .remove-player {
            background: var(--danger-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-weight: bold;
        }

        .topic-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 1.5rem;
        }

        .topic-card {
            background-color: var(--primary-bg);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .topic-card.selected {
            border-color: var(--accent-color);
            transform: scale(1.05);
        }

        .topic-card span { font-size: 2.5rem; }

        #game-screen-content {
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .word-display {
            font-size: 2.5rem;
            color: var(--accent-color);
            font-weight: bold;
            margin: 1rem 0;
        }

        .results-list { list-style: none; padding: 0; width: 100%; }
        .results-list li {
            background-color: var(--primary-bg);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .final-winner {
            color: var(--success-color);
            font-weight: bold;
            text-shadow: 0 0 10px var(--success-color);
        }

        .final-loser {
            color: var(--danger-color);
            font-weight: bold;
            text-shadow: 0 0 10px var(--danger-color);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 100;
        }

        .modal.active { opacity: 1; pointer-events: all; }

        .modal-content {
            background: var(--secondary-bg);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid var(--accent-color);
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            text-align: center;
        }
        
        /* --- â­ ØªØµÙ…ÙŠÙ… Ø®Ø§Øµ Ø¨Ø§Ù„Ø±ÙˆÙ„ÙŠØª --- */
        #roulette-display {
            font-size: 4rem;
            font-weight: bold;
            color: var(--accent-color);
            margin: 2rem 0;
            padding: 1rem;
            min-height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-shadow: 0 0 20px var(--accent-color);
            border: 2px dashed var(--accent-color);
            border-radius: 15px;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="home-screen" class="screen active">
            <h1>ğŸ­<br>Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ©</h1>
            <p>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø®Ø¯Ø§Ø¹ ÙˆØ§Ù„Ø§Ø³ØªÙ†ØªØ§Ø¬... Ù‡Ù„ ØªÙ‚Ø¯Ø± ØªÙƒØ´Ù Ø§Ù„Ù„ÙŠ Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ©ØŸ</p>
            <button class="button" data-action="show-screen" data-screen="setup-screen">Ø§Ø¨Ø¯Ø£ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
            <button class="button secondary" data-action="show-how-to-play">ÙƒÙŠÙ ØªÙ„Ø¹Ø¨ØŸ</button>
        </div>

        <div id="setup-screen" class="screen">
            <h2>Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù„Ø¹Ø¨Ø©</h2>
            <h3>1. Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</h3>
            <div id="topic-selection" class="topic-selection"></div>
            <h3>2. Ø£Ø¶Ù Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† (3 ÙƒØ­Ø¯ Ø£Ø¯Ù†Ù‰)</h3>
            <div class="input-group">
                <input type="text" id="player-name-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨...">
                <button class="button" id="add-player-btn" style="width: auto;">Ø£Ø¶Ù</button>
            </div>
            <ul id="player-list" class="player-list"></ul>
            <button id="start-game-btn" class="button" disabled>Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©!</button>
            <button class="button secondary" data-action="show-screen" data-screen="home-screen">Ø±Ø¬ÙˆØ¹</button>
        </div>

        <div id="game-screen" class="screen">
            <div id="game-screen-content"></div>
        </div>

        <div id="results-screen" class="screen">
            <h2 id="results-title">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h2>
            <div id="results-details"></div>
            <ul id="final-scores" class="results-list"></ul>
            <br>
            <button id="restart-game-btn" class="button">Ø§Ø¨Ø¯Ø£ Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
        </div>
    </div>
    
    <div id="how-to-play-modal" class="modal">
        <div class="modal-content">
            <h2 style="margin-top:0;">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù„Ø¹Ø¨</h2>
            <p><strong>Ø§Ù„Ù‡Ø¯Ù:</strong> Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù„Ø§Ø¹Ø¨ "Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ©".</p>
            <ol style="text-align: right; padding-right: 20px;">
                <li style="margin-bottom: 10px;">Ø§Ù„Ø¬Ù…ÙŠØ¹ (Ù…Ø§ Ø¹Ø¯Ø§ ÙˆØ§Ø­Ø¯) Ø³ÙŠØ­ØµÙ„ÙˆÙ† Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ÙŠØ©.</li>
                <li style="margin-bottom: 10px;">Ø§Ù„Ù„Ø§Ø¹Ø¨ "Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ©" Ù„Ù† ÙŠØ¹Ø±Ù Ø§Ù„ÙƒÙ„Ù…Ø©ØŒ ÙˆÙŠØ¹Ø±Ù ÙÙ‚Ø· Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø¹Ø§Ù….</li>
                <li style="margin-bottom: 10px;">ÙŠØ¨Ø¯Ø£ ÙƒÙ„ Ù„Ø§Ø¹Ø¨ Ø¨Ø·Ø±Ø­ Ø³Ø¤Ø§Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø°ÙŠ ÙŠÙ„ÙŠÙ‡ØŒ ÙˆÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø°ÙƒÙŠØ© Ø¨Ø­ÙŠØ« Ù„Ø§ ØªÙƒØ´Ù Ø§Ù„ÙƒÙ„Ù…Ø© ÙˆÙ„ÙƒÙ† ØªØ«Ø¨Øª Ø£Ù†Ùƒ ØªØ¹Ø±ÙÙ‡Ø§.</li>
                <li style="margin-bottom: 10px;">Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©ØŒ ÙŠØµÙˆØª Ø§Ù„Ø¬Ù…ÙŠØ¹ Ø¹Ù„Ù‰ Ù…Ù† ÙŠØ¹ØªÙ‚Ø¯ÙˆÙ† Ø£Ù†Ù‡ "Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ©".</li>
                <li style="margin-bottom: 10px;">Ø¥Ø°Ø§ ÙƒØ´ÙØªÙ… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„ØµØ­ÙŠØ­ØŒ ÙŠØ­ØµÙ„ ÙƒÙ„ Ù…Ù† ØµÙˆØª Ù„Ù‡ Ø¹Ù„Ù‰ Ù†Ù‚Ø·Ø©. ÙˆØ¥Ø°Ø§ ÙØ´Ù„ØªÙ…ØŒ ÙŠØ­ØµÙ„ "Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ©" Ø¹Ù„Ù‰ Ù†Ù‚Ø·ØªÙŠÙ†!</li>
            </ol>
            <button id="close-how-to-play-btn" class="button">ÙÙ‡Ù…Øª</button>
        </div>
    </div>

    <div id="roulette-modal" class="modal">
        <div class="modal-content">
            <h2>Ø¬Ø§Ø±ÙŠ ÙƒØ´Ù Ø§Ù„Ù…Ø´ØªØ¨Ù‡ Ø¨Ù‡...</h2>
            <div id="roulette-display"></div>
            <p>Ù…Ù† Ù‡Ùˆ Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ©ØŸ</p>
        </div>
    </div>

    <audio id="click-sound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_24915b8e9f.mp3" preload="auto"></audio>
    <audio id="reveal-sound" src="https://cdn.pixabay.com/download/audio/2022/11/22/audio_fb4b370198.mp3" preload="auto"></audio>
    <audio id="success-sound" src="https://cdn.pixabay.com/download/audio/2022/01/18/audio_82c9e7b235.mp3" preload="auto"></audio>
    <audio id="fail-sound" src="https://cdn.pixabay.com/download/audio/2022/03/10/audio_c3ffc74f5d.mp3" preload="auto"></audio>
    <audio id="roulette-sound" src="https://cdn.pixabay.com/download/audio/2022/03/13/audio_2c524a737e.mp3" loop preload="auto"></audio>


    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© (Game State) ---
            const gameState = {
                players: [],
                selectedTopic: null,
                secretWord: null,
                outsider: null,
                currentPlayerIndex: 0,
                turn: 0,
                votes: {},
                scores: {},
                gamePhase: 'home',
            };

            // --- Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒÙ„Ù…Ø§Øª ---
            const keywords = {
                'Ø·Ø¹Ø§Ù…': { words: ['Ø¨ÙŠØªØ²Ø§', 'Ø¨Ø±Ø¬Ø±', 'Ø³ÙˆØ´ÙŠ', 'ÙƒØ¨Ø³Ø©', 'Ø´Ø§ÙˆØ±Ù…Ø§', 'ÙÙ„Ø§ÙÙ„', 'Ù…Ù†Ø³Ù', 'ÙƒÙ†Ø§ÙØ©'], icon: 'ğŸ•' },
                'Ø³ÙØ±': { words: ['Ù…Ø·Ø§Ø±', 'Ø¬ÙˆØ§Ø² Ø³ÙØ±', 'ÙÙ†Ø¯Ù‚', 'Ø´Ø§Ø·Ø¦', 'Ø·Ø§Ø¦Ø±Ø©', 'ØªØ°ÙƒØ±Ø©', 'Ø­Ù‚ÙŠØ¨Ø©', 'ØªØ£Ø´ÙŠØ±Ø©'], icon: 'âœˆï¸' },
                'Ø£ÙÙ„Ø§Ù…': { words: ['Ø³ÙŠÙ†Ù…Ø§', 'Ø¨Ø·Ù„', 'Ù…Ø®Ø±Ø¬', 'Ø£ÙƒØ´Ù†', 'ÙƒÙˆÙ…ÙŠØ¯ÙŠØ§', 'Ø¨ÙˆØ¨ÙƒÙˆØ±Ù†', 'ØªØ°ÙƒØ±Ø©', 'Ù†Ù‡Ø§ÙŠØ©'], icon: 'ğŸ¬' },
                'Ø±ÙŠØ§Ø¶Ø©': { words: ['Ù…Ù„Ø¹Ø¨', 'Ù‡Ø¯Ù', 'ÙƒØ£Ø³', 'Ø­ÙƒÙ…', 'Ø¬Ù…Ù‡ÙˆØ±', 'Ù…Ø¯Ø±Ø¨', 'Ù…Ø§Ø±Ø§Ø«ÙˆÙ†', 'Ù…ÙŠØ¯Ø§Ù„ÙŠØ©'], icon: 'âš½ï¸' },
                'Ø­ÙŠÙˆØ§Ù†Ø§Øª': { words: ['Ø£Ø³Ø¯', 'Ù‚Ø·Ø©', 'ÙÙŠÙ„', 'Ø¨Ø·Ø±ÙŠÙ‚', 'Ø²Ø±Ø§ÙØ©', 'ØªÙ…Ø³Ø§Ø­', 'ÙƒÙ†ØºØ±', 'Ø¨ÙˆÙ…Ø©'], icon: 'ğŸ¦' },
                'Ù…Ù‡Ù†': { words: ['Ø·Ø¨ÙŠØ¨', 'Ù…Ù‡Ù†Ø¯Ø³', 'Ù…Ø¹Ù„Ù…', 'Ø·ÙŠØ§Ø±', 'Ø´Ø±Ø·ÙŠ', 'ÙÙ†Ø§Ù†', 'Ø·Ø¨Ø§Ø®', 'Ù…Ø¨Ø±Ù…Ø¬'], icon: 'ğŸ§‘â€âš•ï¸' },
                'Ø¯ÙˆÙ„': { words: ['Ù…ØµØ±', 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©', 'Ø§Ù„Ø¹Ø±Ø§Ù‚', 'Ø§Ù„ÙŠØ§Ø¨Ø§Ù†', 'Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„', 'Ø¥ÙŠØ·Ø§Ù„ÙŠØ§', 'ÙƒÙ†Ø¯Ø§', 'Ø£Ø³ØªØ±Ø§Ù„ÙŠØ§'], icon: 'ğŸŒ' },
                'ÙÙŠ Ø§Ù„Ù…Ù†Ø²Ù„': { words: ['ØªÙ„ÙØ§Ø²', 'Ø³Ø±ÙŠØ±', 'Ø«Ù„Ø§Ø¬Ø©', 'Ø£Ø±ÙŠÙƒØ©', 'Ù…ÙŠÙƒØ±ÙˆÙˆÙŠÙ', 'Ø³ØªØ§Ø¦Ø±', 'Ø·Ø§ÙˆÙ„Ø©', 'Ù…ØµØ¨Ø§Ø­'], icon: 'ğŸ ' },
            };

            // --- Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ---
            const elements = {
                screens: document.querySelectorAll('.screen'),
                playerNameInput: document.getElementById('player-name-input'),
                addPlayerBtn: document.getElementById('add-player-btn'),
                playerList: document.getElementById('player-list'),
                startGameBtn: document.getElementById('start-game-btn'),
                topicSelectionDiv: document.getElementById('topic-selection'),
                gameScreenContent: document.getElementById('game-screen-content'),
                howToPlayModal: document.getElementById('how-to-play-modal'),
                rouletteModal: document.getElementById('roulette-modal'),
                rouletteDisplay: document.getElementById('roulette-display'),
                resultsTitle: document.getElementById('results-title'),
                resultsDetails: document.getElementById('results-details'),
                finalScores: document.getElementById('final-scores'),
            };

            // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØµÙˆØª ---
            function playSound(soundId) {
                try {
                    const sound = document.getElementById(soundId + '-sound');
                    sound.currentTime = 0;
                    sound.play();
                } catch (e) {
                    console.log(`Could not play sound: ${soundId}`);
                }
            }

            function stopSound(soundId) {
                 try {
                    document.getElementById(soundId + '-sound').pause();
                } catch (e) {
                    console.log(`Could not stop sound: ${soundId}`);
                }
            }
            
            // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ---
            function showScreen(screenId) {
                elements.screens.forEach(s => s.classList.toggle('active', s.id === screenId));
            }

            function showModal(modalId, show) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.toggle('active', show);
                }
            }

            // --- Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù„Ø¹Ø¨Ø© ---
            function populateTopics() {
                elements.topicSelectionDiv.innerHTML = '';
                for (const topic in keywords) {
                    const card = document.createElement('div');
                    card.className = 'topic-card';
                    card.dataset.topic = topic;
                    card.innerHTML = `<span>${keywords[topic].icon}</span><p>${topic}</p>`;
                    elements.topicSelectionDiv.appendChild(card);
                }
            }

            function selectTopic(topicEl) {
                playSound('click');
                elements.topicSelectionDiv.querySelectorAll('.topic-card').forEach(c => c.classList.remove('selected'));
                topicEl.classList.add('selected');
                gameState.selectedTopic = topicEl.dataset.topic;
                validateSetup();
            }

            function addPlayer() {
                const playerName = elements.playerNameInput.value.trim();
                if (playerName && !gameState.players.includes(playerName)) {
                    playSound('click');
                    gameState.players.push(playerName);
                    if (gameState.scores[playerName] === undefined) {
                        gameState.scores[playerName] = 0;
                    }
                    updatePlayerList();
                    elements.playerNameInput.value = '';
                    elements.playerNameInput.focus();
                }
                validateSetup();
            }

            function removePlayer(playerName) {
                playSound('click');
                gameState.players = gameState.players.filter(p => p !== playerName);
                updatePlayerList();
                validateSetup();
            }

            function updatePlayerList() {
                elements.playerList.innerHTML = '';
                gameState.players.forEach(player => {
                    const li = document.createElement('li');
                    li.className = 'player-item';
                    li.innerHTML = `<span>${player}</span><button class="remove-player" data-player="${player}">X</button>`;
                    elements.playerList.appendChild(li);
                });
            }

            function validateSetup() {
                elements.startGameBtn.disabled = !(gameState.players.length >= 3 && gameState.selectedTopic);
            }

            function startGame() {
                playSound('success');
                const topicWords = keywords[gameState.selectedTopic].words;
                gameState.secretWord = topicWords[Math.floor(Math.random() * topicWords.length)];
                const outsiderIndex = Math.floor(Math.random() * gameState.players.length);
                gameState.outsider = gameState.players[outsiderIndex];
                gameState.votes = {};
                gameState.currentPlayerIndex = 0;
                gameState.gamePhase = 'reveal';
                renderGameScreen();
                showScreen('game-screen');
            }
            
            function restartGame() {
                playSound('click');
                gameState.selectedTopic = null;
                // Ù„Ø§ Ù†Ø¹ÙŠØ¯ ØªØµÙÙŠØ± Ø§Ù„Ù†Ù‚Ø§Ø· Ø£Ùˆ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©
                populateTopics();
                validateSetup();
                showScreen('setup-screen');
            }
            
            // --- ÙˆØ¸Ø§Ø¦Ù Ø¹Ø±Ø¶ Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø© ---
            function renderGameScreen() {
                const phase = gameState.gamePhase;
                if (phase === 'reveal') renderRevealPhase();
                else if (phase === 'questions') renderQuestionPhase();
                else if (phase === 'voting') renderVotingPhase();
                else if (phase === 'bonus') renderBonusRoundPhase();
            }

            function renderRevealPhase() {
                const player = gameState.players[gameState.currentPlayerIndex];
                elements.gameScreenContent.innerHTML = `<h2>Ù…Ø±Ù‘Ø± Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¥Ù„Ù‰</h2><h1 style="font-size: 3rem;">${player}</h1><p>Ø¹Ù†Ø¯Ù…Ø§ ØªÙƒÙˆÙ† Ø¬Ø§Ù‡Ø²Ø§Ù‹ØŒ Ø§Ø¶ØºØ· Ù„ÙƒØ´Ù Ø¯ÙˆØ±Ùƒ.</p><button class="button" data-action="show-role">Ø£Ù†Ø§ ${player}ØŒ Ø§ÙƒØ´Ù Ø¹Ù† Ø¯ÙˆØ±ÙŠ</button>`;
            }
            
            function showPlayerRole() {
                playSound('reveal');
                const player = gameState.players[gameState.currentPlayerIndex];
                let roleHTML = (player === gameState.outsider) ?
                    `<h1>Ø£Ù†Øª Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ©! ğŸ­</h1><h3>Ù…Ù‡Ù…ØªÙƒ: Ù„Ø§ ØªÙƒØ´Ù Ù†ÙØ³Ùƒ ÙˆØ­Ø§ÙˆÙ„ Ù…Ø¹Ø±ÙØ© Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ÙŠØ©.</h3><h4>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø¹Ø§Ù… Ù‡Ùˆ: ${gameState.selectedTopic}</h4>` :
                    `<h3>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹: ${gameState.selectedTopic}</h3><h1>Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ÙŠØ©:</h1><div class="word-display">${gameState.secretWord}</div>`;
                elements.gameScreenContent.innerHTML = `${roleHTML}<br><button class="button" data-action="hide-role">ÙÙ‡Ù…Øª! (Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©)</button>`;
            }

            function hidePlayerRole() {
                gameState.currentPlayerIndex++;
                if (gameState.currentPlayerIndex < gameState.players.length) {
                    renderRevealPhase();
                } else {
                    gameState.gamePhase = 'questions';
                    gameState.turn = 0;
                    renderGameScreen();
                }
            }

            function renderQuestionPhase() {
                const asker = gameState.players[gameState.turn % gameState.players.length];
                const responder = gameState.players[(gameState.turn + 1) % gameState.players.length];
                elements.gameScreenContent.innerHTML = `<h2>Ø§Ù„Ø¬ÙˆÙ„Ø© ${Math.floor(gameState.turn / gameState.players.length) + 1}</h2><h3>Ø­Ø§Ù† Ø¯ÙˆØ± <span style="color:white;">${asker}</span></h3><p>Ø§Ø³Ø£Ù„ Ø³Ø¤Ø§Ù„Ø§Ù‹ Ù„Ù€ <span style="color:white;">${responder}</span></p><button class="button" data-action="next-turn">ØªÙ… Ø§Ù„Ø³Ø¤Ø§Ù„ØŒ Ù†Ù†ØªÙ‚Ù„ Ù„Ù„ØªØ§Ù„ÙŠ</button>`;
            }

            function nextTurn() {
                playSound('click');
                gameState.turn++;
                // Ù†ÙƒØªÙÙŠ Ø¨Ø¬ÙˆÙ„Ø© Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ø­Ø¯Ø© (ÙƒÙ„ Ù„Ø§Ø¹Ø¨ ÙŠØ³Ø£Ù„ Ù…Ø±Ø©)
                if (gameState.turn >= gameState.players.length) {
                    gameState.gamePhase = 'voting';
                    gameState.currentPlayerIndex = 0;
                    renderGameScreen();
                } else {
                    renderQuestionPhase();
                }
            }

            function renderVotingPhase() {
                const voter = gameState.players[gameState.currentPlayerIndex];
                let optionsHTML = gameState.players
                    .filter(p => p !== voter)
                    .map(p => `<button class="button secondary" data-action="cast-vote" data-vote-for="${p}">${p}</button>`)
                    .join('');
                elements.gameScreenContent.innerHTML = `<h2>Ø­Ø§Ù† ÙˆÙ‚Øª Ø§Ù„ØªØµÙˆÙŠØª!</h2><h3><span style="color:white;">${voter}</span>ØŒ Ù…Ù† Ø¨Ø±Ø£ÙŠÙƒ Ù‡Ùˆ "Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ©"ØŸ</h3><div class="button-group">${optionsHTML}</div>`;
            }

            function castVote(votedFor) {
                playSound('click');
                const voter = gameState.players[gameState.currentPlayerIndex];
                gameState.votes[voter] = votedFor;
                gameState.currentPlayerIndex++;
                if (gameState.currentPlayerIndex < gameState.players.length) {
                    elements.gameScreenContent.innerHTML = `<h2>ØªÙ… ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙƒ Ø¨Ø³Ø±ÙŠØ©.</h2><p>Ù…Ø±Ù‘Ø± Ø§Ù„Ø¬Ù‡Ø§Ø² Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„ØªØ§Ù„ÙŠ.</p><button class="button" data-action="next-voter">Ø§Ù„ØªØ§Ù„ÙŠ</button>`;
                } else {
                    calculateResults();
                }
            }

            function calculateResults() {
                const voteCounts = {};
                gameState.players.forEach(p => voteCounts[p] = 0);

                let correctVoters = [];
                for (const voter in gameState.votes) {
                    const votedFor = gameState.votes[voter];
                    if (votedFor) voteCounts[votedFor]++;
                    if (votedFor === gameState.outsider) {
                        correctVoters.push(voter);
                    }
                }
                
                correctVoters.forEach(p => gameState.scores[p]++);

                let maxVotes = 0, accusedPlayers = [];
                for (const player in voteCounts) {
                    if (voteCounts[player] > maxVotes) {
                        maxVotes = voteCounts[player];
                        accusedPlayers = [player];
                    } else if (voteCounts[player] === maxVotes) {
                        accusedPlayers.push(player);
                    }
                }

                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ØªØ¹Ø§Ø¯Ù„ØŒ Ù†Ø®ØªØ§Ø± ÙˆØ§Ø­Ø¯Ø§Ù‹ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ§Ù‹ Ù…Ù†Ù‡Ù… Ù„ÙŠÙƒÙˆÙ† Ø§Ù„Ù…ØªÙ‡Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
                const accusedPlayer = accusedPlayers[Math.floor(Math.random() * accusedPlayers.length)];
                
                startRevealRoulette(accusedPlayer);
            }

            // --- â­ ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø±ÙˆÙ„ÙŠØª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ---
            function startRevealRoulette(accusedPlayer) {
                showModal('roulette-modal', true);
                playSound('roulette');
                
                let delay = 75;
                let duration = 3000; // 3 Ø«ÙˆØ§Ù†ÙŠ
                let startTime = Date.now();
                
                const intervalId = setInterval(() => {
                    // Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø±ÙŠØ¹
                    const randomPlayer = gameState.players[Math.floor(Math.random() * gameState.players.length)];
                    elements.rouletteDisplay.textContent = randomPlayer;

                    // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø±ÙˆÙ„ÙŠØª Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…Ø¯Ø©
                    if (Date.now() - startTime > duration) {
                        clearInterval(intervalId);
                        stopSound('roulette');
                        elements.rouletteDisplay.textContent = accusedPlayer; // Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªÙ‡Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
                        
                        setTimeout(() => {
                           showModal('roulette-modal', false);
                           handleAccusationResult(accusedPlayer);
                        }, 2000); // Ø§Ù†ØªØ¸Ø± Ø«Ø§Ù†ÙŠØªÙŠÙ† Ø¨Ø¹Ø¯ Ø§Ù„ÙƒØ´Ù
                    }
                }, delay);
            }

            function handleAccusationResult(accusedPlayer) {
                if (accusedPlayer === gameState.outsider) {
                    playSound('fail'); // ØµÙˆØª ÙØ´Ù„ Ù„Ø£Ù†Ù‡ ØªÙ… ÙƒØ´ÙÙ‡
                    gameState.gamePhase = 'bonus';
                    renderGameScreen();
                } else {
                    playSound('success'); // ØµÙˆØª Ù†Ø¬Ø§Ø­ Ù„Ø£Ù†Ù‡ Ø®Ø¯Ø¹Ù‡Ù…
                    gameState.scores[gameState.outsider] += 2;
                    showFinalScores(
                        'Ù„Ù‚Ø¯ Ø®Ø¯Ø¹Ù‡Ù…!',
                        `<p>Ø§Ù„Ù„Ø§Ø¹Ø¨ <strong class="final-winner">${gameState.outsider}</strong> Ù†Ø¬Ø­ ÙÙŠ Ø®Ø¯Ø§Ø¹ Ø§Ù„Ø¬Ù…ÙŠØ¹ ÙˆØ­ØµÙ„ Ø¹Ù„Ù‰ Ù†Ù‚Ø·ØªÙŠÙ†!</p><p>ØªÙ… Ø§ØªÙ‡Ø§Ù… ${accusedPlayer} Ø¨Ø§Ù„Ø®Ø·Ø£. Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© ÙƒØ§Ù†Øª: <strong>${gameState.secretWord}</strong></p>`
                    );
                }
            }
            
            function renderBonusRoundPhase() {
                const options = getBonusOptions();
                const optionsHTML = options.map(opt => `<button class="button secondary" data-action="check-bonus" data-answer="${opt}">${opt}</button>`).join('');

                elements.gameScreenContent.innerHTML = `
                    <h2>ØªÙ… ÙƒØ´Ù <span class="final-loser">${gameState.outsider}</span>!</h2>
                    <h3>ØªØ­Ø¯ÙŠ Ø£Ø®ÙŠØ± Ù„Ù‡:</h3>
                    <p>Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ®Ù…ÙŠÙ† Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ÙŠØ© Ù„ÙƒØ³Ø¨ Ù†Ù‚Ø·Ø© Ø´Ø±ÙØŸ</p>
                    <div class="button-group">${optionsHTML}</div>
                `;
            }

            function getBonusOptions() {
                const correctWord = gameState.secretWord;
                const allWords = keywords[gameState.selectedTopic].words;
                const distractors = allWords.filter(w => w !== correctWord);
                
                for (let i = distractors.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [distractors[i], distractors[j]] = [distractors[j], distractors[i]];
                }
                
                const finalOptions = distractors.slice(0, 3);
                finalOptions.push(correctWord);
                return finalOptions.sort(() => Math.random() - 0.5);
            }

            function checkBonusAnswer(answer) {
                let title, details;
                if (answer === gameState.secretWord) {
                    playSound('success');
                    gameState.scores[gameState.outsider]++;
                    title = 'ØªØ®Ù…ÙŠÙ† ØµØ­ÙŠØ­!';
                    details = `<p>Ù†Ø¬Ø­ <strong class="final-winner">${gameState.outsider}</strong> ÙÙŠ Ù…Ø¹Ø±ÙØ© Ø§Ù„ÙƒÙ„Ù…Ø© ÙˆÙƒØ³Ø¨ Ù†Ù‚Ø·Ø© Ø´Ø±Ù.</p>`;
                } else {
                    playSound('fail');
                    title = 'ØªØ®Ù…ÙŠÙ† Ø®Ø§Ø·Ø¦!';
                    details = `<p>Ù„Ù„Ø£Ø³ÙØŒ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© ÙƒØ§Ù†Øª: <strong>${gameState.secretWord}</strong></p>`;
                }
                showFinalScores(title, details);
            }

            function showFinalScores(title, details) {
                showScreen('results-screen');
                elements.resultsTitle.innerText = title;
                elements.resultsDetails.innerHTML = details;
                
                elements.finalScores.innerHTML = '<h3>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©:</h3>';
                Object.keys(gameState.scores)
                    .sort((a, b) => gameState.scores[b] - gameState.scores[a])
                    .forEach(player => {
                        const li = document.createElement('li');
                        li.innerText = `${player}: ${gameState.scores[player]} Ù†Ù‚Ø·Ø©`;
                        elements.finalScores.appendChild(li);
                });
            }

            // --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« (Event Listeners) ---
            document.body.addEventListener('click', (e) => {
                const action = e.target.dataset.action;
                if (!action) return;
                
                playSound('click');

                switch(action) {
                    case 'show-screen': showScreen(e.target.dataset.screen); break;
                    case 'show-how-to-play': showModal('how-to-play-modal', true); break;
                    case 'show-role': showPlayerRole(); break;
                    case 'hide-role': hidePlayerRole(); break;
                    case 'next-turn': nextTurn(); break;
                    case 'next-voter': renderVotingPhase(); break;
                    case 'cast-vote': castVote(e.target.dataset.voteFor); break;
                    case 'check-bonus': checkBonusAnswer(e.target.dataset.answer); break;
                }
            });

            elements.addPlayerBtn.addEventListener('click', addPlayer);
            elements.playerNameInput.addEventListener('keypress', (e) => {
                if(e.key === 'Enter') addPlayer();
            });

            elements.startGameBtn.addEventListener('click', startGame);
            document.getElementById('restart-game-btn').addEventListener('click', restartGame);
            document.getElementById('close-how-to-play-btn').addEventListener('click', () => {
                playSound('click');
                showModal('how-to-play-modal', false);
            });

            // Event Delegation for dynamic elements
            elements.topicSelectionDiv.addEventListener('click', (e) => {
                const card = e.target.closest('.topic-card');
                if (card) selectTopic(card);
            });

            elements.playerList.addEventListener('click', (e) => {
                if (e.target.classList.contains('remove-player')) {
                    removePlayer(e.target.dataset.player);
                }
            });

            // --- Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ---
            populateTopics();
            showScreen('home-screen');
        });
    </script>
</body>
</html>
